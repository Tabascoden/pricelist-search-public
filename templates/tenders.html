{% extends 'base.html' %}
{% block content %}

<div class="card" id="tenders-demo">
  <div class="cardHeader tender-flex">
    <div>
      <h1>Тендеры</h1>
      <div class="sub">Демо-визуализация (без БД/SQL). Логика и UX.</div>
    </div>

    <form id="tender-create-form" class="tender-flex tender-form" autocomplete="off">
      <input type="text" name="title" id="tender-title" class="input" placeholder="Название проекта (опционально)">
      <button class="btn primary" type="submit" id="tender-create-btn">Создать</button>
    </form>
  </div>

  <!-- LIST VIEW -->
  <div id="tenders-view-list">
    <div class="tender-hint">
      <span class="tag">Демо</span>
      «Открыть» ведёт на <code>/tenders/&lt;id&gt;</code> (в демо — без перезагрузки). «Удалить» удаляет только в UI (localStorage).
    </div>
    <div id="tender-projects" class="tender-table-wrap">Загрузка…</div>
  </div>

  <!-- PROJECT VIEW -->
  <div id="tenders-view-project" class="hidden">
    <div class="tender-topbar">
      <button class="btn" id="tender-back">← Назад к списку</button>

      <div class="tender-title">
        <div class="h2" id="tender-project-title">Тендер</div>
        <div class="sub" id="tender-project-subtitle">
          Сравнение предложений разных поставщиков. Эталон и альтернативы.
        </div>
      </div>

      <div class="tender-actions">
        <input type="file" id="tender-upload" accept=".xlsx" style="max-width:220px;">
        <button class="btn" id="tender-upload-btn">Загрузить XLSX</button>
        <button class="btn" id="tender-autopick">Автоподбор</button>
        <button class="btn primary" id="tender-export">Экспорт</button>
      </div>
    </div>

    <div class="tender-hint">
      <span class="tag">Логика</span>
      1) Ищем кандидатов по строке закупки. 2) Пользователь выбирает «Эталон». 3) Дальше альтернативы ищем по эталону.
      Везде «Поставщик» — отдельным столбцом.
    </div>

    <div id="tender-items" class="tender-table-wrap">Загрузка…</div>
  </div>

  <!-- MODAL -->
  <div class="tender-modal hidden" id="tender-modal" aria-hidden="true">
    <div class="tender-modal-body" role="dialog" aria-modal="true">
      <div class="tender-modal-header">
        <div>
          <div class="h3">Варианты поставщиков</div>
          <div class="sub" id="tender-modal-subtitle">Позиция: …</div>
        </div>
        <button class="btn" id="tender-modal-close">Закрыть</button>
      </div>

      <div class="tender-modal-controls">
        <div class="tender-control">
          <div class="tender-control-title">Ручной поиск</div>
          <input class="input" id="tender-search-manual" placeholder="Например: помидоры сливовидные">
          <div class="sub">Если заполнено — ищем по этой строке, независимо от «основы поиска».</div>
        </div>

        <div class="tender-control">
          <div class="tender-control-title">Основа поиска</div>
          <select class="input" id="tender-search-base">
            <option value="purchase">По строке закупки</option>
            <option value="benchmark">По эталону</option>
          </select>
          <div class="sub" id="tender-search-base-hint">Ищем по строке закупки (первичный подбор альтернатив).</div>
        </div>

        <div class="tender-control-actions">
          <button class="btn primary" id="tender-search-btn">Найти</button>
          <button class="btn" id="tender-search-reset">Сброс</button>
        </div>
      </div>

      <div class="tender-legend">
        <div class="tender-legend-title">Текущий эталон</div>
        <div id="tender-benchmark-box" class="tender-benchmark-box">
          Эталон ещё не выбран. Найдите кандидатов и нажмите «Сделать эталоном».
        </div>
      </div>

      <div class="tender-legend">
        <div class="tender-legend-title">
          Результаты поиска / кандидаты
          <span class="sub" id="tender-candidates-mode">— режим: по строке закупки</span>
        </div>

        <div class="tableWrap">
          <table class="tender-offers-table" id="tender-offers-table">
            <thead>
              <tr>
                <th class="sortable" data-sort="supplier">Поставщик</th>
                <th class="sortable" data-sort="name">Товар</th>
                <th class="sortable" data-sort="price">Цена</th>
                <th class="sortable" data-sort="ppu">Цена/ед</th>
                <th class="sortable" data-sort="score">Score</th>
                <th>Действия</th>
              </tr>
            </thead>
            <tbody id="tender-offers-body">
              <tr><td colspan="6" class="sub">Нажмите «Найти».</td></tr>
            </tbody>
          </table>
        </div>

        <div class="sub" style="margin-top:10px;">
          Сортировка: клик по заголовку столбца. Повторный клик меняет направление.
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  #tenders-demo .tender-flex { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
  #tenders-demo .tender-form { margin-left:auto; }
  #tenders-demo .tender-table-wrap { width:100%; }

  #tenders-demo .tender-hint {
    margin: 14px 0;
    padding: 10px 12px;
    border: 1px solid var(--border);
    border-radius: 12px;
    background: #fbfcff;
    color: #2b3a55;
    font-size: 13px;
  }
  #tenders-demo .tag {
    display:inline-flex; align-items:center;
    padding: 3px 8px;
    border-radius: 999px;
    background: #eef2ff;
    color: #312e81;
    font-weight: 700;
    font-size: 12px;
    margin-right: 8px;
  }

  #tenders-demo .tender-topbar {
    display:flex; align-items:center; gap:12px; flex-wrap:wrap;
    padding: 8px 0 0 0;
  }
  #tenders-demo .tender-title { flex: 1 1 auto; min-width: 240px; }
  #tenders-demo .h2 { font-size: 20px; font-weight: 800; }
  #tenders-demo .h3 { font-size: 16px; font-weight: 800; }
  #tenders-demo .tender-actions { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

  #tenders-demo .hidden { display:none !important; }

  #tenders-demo .tender-grid {
    width:100%;
    border: 1px solid var(--border);
    border-radius: 14px;
    overflow: hidden;
  }
  #tenders-demo .tender-grid table { width:100%; border-collapse: collapse; }
  #tenders-demo .tender-grid th, #tenders-demo .tender-grid td {
    padding: 12px 12px;
    border-bottom: 1px solid var(--border);
    vertical-align: top;
    text-align: left;
    font-size: 13px;
  }
  #tenders-demo .tender-grid thead th {
    background: #f8fafc;
    font-size: 12px;
    text-transform: uppercase;
    color: #475569;
    letter-spacing: .02em;
  }
  #tenders-demo .tender-actions-col {
    display:flex; flex-direction:column; gap:8px; align-items:flex-end;
  }

  #tenders-demo .mini {
    width:100%;
    border:1px solid #e6ebff;
    border-radius: 12px;
    overflow:hidden;
  }
  #tenders-demo .mini table { width:100%; border-collapse:collapse; }
  #tenders-demo .mini td, #tenders-demo .mini th {
    padding: 8px 10px;
    border-bottom: 1px solid #eef2ff;
    font-size: 12px;
  }
  #tenders-demo .mini th { background:#f3f6ff; color:#334155; text-transform:none; letter-spacing:0; }

  #tenders-demo .tender-modal {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.35);
    display:flex; align-items:center; justify-content:center;
    z-index: 200;
    padding: 20px;
  }
  #tenders-demo .tender-modal-body {
    background: #fff;
    width: min(1100px, 96vw);
    max-height: 86vh;
    overflow: auto;
    border-radius: 16px;
    padding: 16px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
  }
  #tenders-demo .tender-modal-header {
    display:flex; align-items:center; justify-content:space-between;
    gap: 12px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 12px;
  }
  #tenders-demo .tender-modal-controls {
    display:grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 12px;
    align-items:end;
    margin-bottom: 14px;
  }
  #tenders-demo .tender-control {
    border: 1px solid #e6ebff;
    border-radius: 14px;
    padding: 12px;
    background: #fbfcff;
  }
  #tenders-demo .tender-control-title {
    font-weight: 800;
    font-size: 12px;
    text-transform: uppercase;
    color: #334155;
    margin-bottom: 8px;
    letter-spacing: .02em;
  }
  #tenders-demo .tender-control-actions { display:flex; gap:10px; align-items:center; justify-content:flex-end; }

  #tenders-demo .tender-legend { margin-top: 10px; }
  #tenders-demo .tender-legend-title { font-weight: 800; margin-bottom: 8px; }
  #tenders-demo .tender-benchmark-box {
    border: 1px solid #e6ebff;
    border-radius: 14px;
    padding: 10px 12px;
    background: #ffffff;
    color: #334155;
    font-size: 13px;
  }

  #tenders-demo .tender-offers-table { width:100%; border-collapse: collapse; }
  #tenders-demo .tender-offers-table th, #tenders-demo .tender-offers-table td {
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
    text-align:left;
    font-size: 13px;
    vertical-align: top;
  }
  #tenders-demo .tender-offers-table th { background:#f8fafc; color:#475569; font-size:12px; text-transform: uppercase; }
  #tenders-demo th.sortable { cursor:pointer; user-select:none; }
  #tenders-demo th.sortable:hover { background:#f1f5f9; }

  @media (max-width: 900px) {
    #tenders-demo .tender-modal-controls { grid-template-columns: 1fr; }
    #tenders-demo .tender-actions-col { align-items:stretch; }
  }
</style>

<script src="/static/tenders.js" defer></script>
{% endblock %}
