{% extends 'base.html' %}
{% block content %}
<div class="card" id="tender-project" data-project-id="{{ project_id }}">
  <div class="cardHeader tender-flex">
    <div>
      <h1>Тендер #{{ project_id }}</h1>
      <div class="sub">
        Демо-визуализация: эталон и альтернативы. Пока без БД/SQL.
      </div>
    </div>

    <div class="tender-flex tender-actions-top">
      <div class="tender-upload">
        <input type="file" id="tender-upload" accept=".xlsx" disabled>
        <button class="btn" id="tender-upload-btn" disabled title="В демо не загружаем файл">
          Загрузить XLSX
        </button>
      </div>

      <button class="btn" id="tender-autopick" title="В демо просто проставит эталоны для наглядности">
        Автоподбор
      </button>

      <button class="btn primary" id="tender-export" title="В демо экспорт не включён">
        Экспорт
      </button>
    </div>
  </div>

  <div class="tender-legend">
    <div class="pill">Эталон</div>
    <div class="muted">
      Альтернативы сначала ищем по строке закупки, а после выбора эталона — по эталону.
      “Поставщик” везде отдельной колонкой.
    </div>
  </div>

  <div id="tender-items" class="tender-table-wrap"></div>
</div>

<!-- Modal: Supplier variants -->
<div class="tender-modal hidden" id="tender-modal" aria-hidden="true">
  <div class="tender-modal-body" role="dialog" aria-modal="true">
    <div class="tender-modal-header">
      <div>
        <h3 id="tender-modal-title">Варианты поставщиков</h3>
        <div class="sub" id="tender-modal-subtitle"></div>
      </div>
      <button class="btn" id="tender-modal-close">Закрыть</button>
    </div>

    <!-- Search controls -->
    <div class="tender-controls">
      <div class="tender-controls-row">
        <div class="tender-field">
          <div class="tender-label">Ручной поиск</div>
          <input class="input" id="tender-search-input" placeholder="Например: помидоры сливовидные 10кг">
          <div class="muted">Если заполнено — ищем по этой строке, независимо от “основы поиска”.</div>
        </div>

        <div class="tender-field">
          <div class="tender-label">Основа поиска</div>
          <select class="input" id="tender-search-basis">
            <option value="row">По строке закупки</option>
            <option value="baseline">По эталону (если выбран)</option>
          </select>
          <div class="muted" id="tender-basis-hint"></div>
        </div>

        <div class="tender-controls-actions">
          <button class="btn primary" id="tender-search-btn">Найти</button>
          <button class="btn" id="tender-search-reset">Сброс</button>
        </div>
      </div>
    </div>

    <!-- Current baseline -->
    <div class="tender-section">
      <div class="tender-section-title">
        Текущий эталон
        <span class="pill" id="tender-baseline-pill" style="display:none;">Эталон выбран</span>
      </div>
      <div id="tender-baseline-box" class="tender-box"></div>
    </div>

    <!-- Candidates -->
    <div class="tender-section">
      <div class="tender-section-title">
        Результаты поиска / кандидаты
        <span class="muted" id="tender-search-mode"></span>
      </div>
      <div id="tender-candidates" class="tender-table-wrap"></div>
    </div>

    <!-- Alternatives -->
    <div class="tender-section">
      <div class="tender-section-title">
        Альтернативы (авто)
        <span class="muted" id="tender-alts-mode"></span>
      </div>
      <div id="tender-alternatives" class="tender-table-wrap"></div>
    </div>
  </div>
</div>

<style>
  .tender-flex { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
  .tender-actions-top { margin-left:auto; }
  .tender-upload { display:flex; gap:8px; align-items:center; }

  .tender-legend { display:flex; align-items:center; gap:12px; padding:12px; border:1px solid var(--border); border-radius:12px; background:#fff; margin-top:12px; }
  .pill { display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; background:#eef2ff; color:#312e81; font-size:12px; font-weight:700; }
  .muted { color:#64748b; font-size:12px; }

  .tender-table-wrap { width:100%; margin-top:12px; }
  .tender-table { width:100%; border-collapse:collapse; }
  .tender-table th, .tender-table td { border-bottom:1px solid var(--border); padding:10px 12px; text-align:left; vertical-align:top; }
  .tender-table th { background:#f8fafc; font-size:12px; letter-spacing:.02em; text-transform:uppercase; color:#475569; }
  .tender-row-actions { display:flex; gap:8px; flex-wrap:wrap; }
  .tag { display:inline-flex; align-items:center; padding:4px 10px; border-radius:999px; background:#ecfeff; color:#155e75; font-size:12px; font-weight:700; }

  /* Modal */
  .tender-modal { position:fixed; inset:0; background:rgba(0,0,0,.35); display:flex; align-items:center; justify-content:center; z-index:100; padding:16px; }
  .tender-modal.hidden { display:none; }
  .tender-modal-body { background:#fff; border-radius:16px; width:min(1100px, 98vw); max-height:92vh; overflow:auto; box-shadow: var(--shadow); padding:16px; }
  .tender-modal-header { display:flex; align-items:center; justify-content:space-between; gap:12px; padding-bottom:12px; border-bottom:1px solid var(--border); }
  .tender-controls { margin-top:12px; padding:12px; border:1px solid var(--border); border-radius:12px; background:#fff; }
  .tender-controls-row { display:grid; grid-template-columns: 1.4fr 0.8fr 0.6fr; gap:12px; align-items:start; }
  .tender-controls-actions { display:flex; gap:8px; align-items:center; justify-content:flex-end; padding-top:22px; }
  .tender-label { font-size:12px; font-weight:800; color:#334155; text-transform:uppercase; letter-spacing:.02em; margin-bottom:6px; }
  .tender-section { margin-top:14px; }
  .tender-section-title { display:flex; align-items:center; gap:10px; font-weight:900; color:#0f172a; }
  .tender-box { border:1px solid var(--border); border-radius:12px; padding:12px; background:#fff; }
  .tender-box .empty { color:#64748b; font-size:13px; }

  @media (max-width: 900px) {
    .tender-controls-row { grid-template-columns: 1fr; }
    .tender-controls-actions { justify-content:flex-start; padding-top:0; }
  }
</style>

<script>
  window.__tendersDemoMode = "project";
</script>
<script src="/static/tenders_demo.js"></script>
{% endblock %}
